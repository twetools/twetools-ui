"use client";
import React, { useRef, useEffect } from "react";

/**
 * Modal component props
 */
interface ModalProps {
  /** Controls whether the modal is visible */
  isOpen: boolean;
  /** Callback function called when modal should close */
  onClose: () => void;
  /** Additional CSS classes to apply to the modal */
  className?: string;
  /** Modal content */
  children: React.ReactNode;
  /** Whether to show the default close button */
  showCloseButton?: boolean;
  /** Whether to render the modal in fullscreen mode */
  isFullscreen?: boolean;
}

/**
 * A reusable modal component with built-in focus management and accessibility features.
 *
 * @example
 * ```tsx
 * <Modal isOpen={isOpen} onClose={handleClose}>
 *   <div>Modal content</div>
 * </Modal>
 * ```
 */

export const Modal: React.FC<ModalProps> = ({
  isOpen,
  onClose,
  children,
  className,
  showCloseButton = true,
  isFullscreen = false,
}) => {
  const modalRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleEscape = (event: KeyboardEvent) => {
      if (event.key === "Escape") {
        onClose();
      }
    };

    if (isOpen) {
      document.addEventListener("keydown", handleEscape);
    }

    return () => {
      document.removeEventListener("keydown", handleEscape);
    };
  }, [isOpen, onClose]);

  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = "hidden";
    } else {
      document.body.style.overflow = "unset";
    }

    return () => {
      document.body.style.overflow = "unset";
    };
  }, [isOpen]);

  if (!isOpen) return null;

  const contentClasses = isFullscreen
    ? "w-full h-full"
    : "relative w-full rounded-3xl bg-white dark:bg-gray-900";

  return (
    <div
      className="fixed inset-0 flex items-center justify-center overflow-y-auto modal z-99999"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modal-title"
    >
      {!isFullscreen && (
        <div
          className="fixed inset-0 h-full w-full bg-gray-400/50 backdrop-blur-[32px]"
          onClick={onClose}
          aria-label="Close modal"
        />
      )}
      <div ref={modalRef} className={`${contentClasses} ${className || ""}`}>
        {showCloseButton && (
          <button
            onClick={onClose}
            aria-label="Close modal"
            className="absolute right-3 top-3 z-999 flex h-9.5 w-9.5 items-center justify-center rounded-md border border-gray-300 bg-white hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white sm:right-6 sm:top-6 sm:h-11 sm:w-11"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
              fill="currentColor"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M6.04289 16.5413C5.65237 16.9318 5.65237 17.565 6.04289 17.9555C6.43342 18.346 7.06658 18.346 7.45711 17.9555L12 13.4127L16.5429 17.9555C16.9334 18.346 17.5666 18.346 17.9571 17.9555C18.3476 17.565 18.3476 16.9318 17.9571 16.5413L13.4142 12L17.9571 7.45871C18.3476 7.06819 18.3476 6.43503 17.9571 6.0445C17.5666 5.65398 16.9334 5.65398 16.5429 6.0445L12 10.5873L7.45711 6.0445C7.06658 5.65398 6.43342 5.65398 6.04289 6.0445C5.65237 6.43503 5.65237 7.06819 6.04289 7.45871L10.5858 12L6.04289 16.5413Z"
              />
            </svg>
          </button>
        )}
        <div>{children}</div>
      </div>
    </div>
  );
};

export default Modal;
